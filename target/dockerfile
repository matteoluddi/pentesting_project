FROM kalilinux/kali-last-release

#Update + Upgrade
RUN apt-get update && apt-get upgrade -y

#Install Tools
RUN apt-get install -y wget openssh-server && apt-get clean

#Enable remote root login
RUN echo 'PermitRootLogin yes' >> /etc/ssh/sshd_config

#Set root password for remote login
RUN echo 'root:ThisIsADifficultPwd00!' | chpasswd

#Create a new user
RUN useradd -m -d /home/newuser -s /bin/bash newuser
RUN echo 'newuser:rogerrabbit' | chpasswd
RUN mkdir /home/newuser/.ssh
RUN touch /home/newuser/.ssh/authorized_keys
RUN chown -R newuser:newuser /home/newuser/.ssh
RUN chmod 700 /home/newuser/.ssh
RUN chmod 600 /home/newuser/.ssh/authorized_keys

RUN wget https://github.com/gabrieledintino/pentesting_project/blob/main/resources/SecretPass.zip?raw=true -P /home/newuser/
RUN mv /home/newuser/SecretPass.zip?raw=true /home/newuser/SecretPass.zip
RUN wget https://github.com/gabrieledintino/pentesting_project/blob/main/resources/SecretPassDigits.rar?raw=true -P /home/newuser/
RUN mv /home/newuser/SecretPassDigits.rar?raw=true /home/newuser/SecretPassDigits.rar
RUN wget https://github.com/gabrieledintino/pentesting_project/blob/main/resources/SecretPasswordSingle.rar?raw=true -P /home/newuser/
RUN mv /home/newuser/SecretPasswordSingle.rar?raw=true /home/newuser/SecretPasswordSingle.rar
RUN wget https://github.com/gabrieledintino/pentesting_project/blob/main/resources/mybash?raw=true -P /home/newuser/
RUN mv  /home/newuser/mybash?raw=true /home/newuser/mybash
RUN chmod a=rwxs /home/newuser/mybash


#Start the ssh service
ENTRYPOINT service ssh restart && bash
